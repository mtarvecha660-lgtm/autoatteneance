<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Attendance & Personalized Planning System</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.4.4/build/qrcode.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>

    <link rel="stylesheet" href="style.css">
</head>
<body class="antialiased text-gray-200">

    <div id="app" class="min-h-screen w-full flex flex-col items-center justify-center p-4 relative overflow-hidden">

        <div id="loading-view" class="view active-view text-center">
            <svg class="animate-spin h-10 w-10 text-white mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <p id="loading-text" class="mt-4 text-lg font-semibold text-gray-300">Initializing System...</p>
        </div>

        <div id="login-view" class="view w-full max-w-sm">
            <div class="card animate-fadeInUp">
                <div class="text-center">
                    <h1 class="text-4xl font-extrabold text-white mb-2 tracking-tight">Smart Campus</h1>
                    <p class="text-gray-300 mb-8">Sign in to your dashboard</p>
                </div>
                <form id="login-form" class="space-y-6">
                    <div>
                        <input type="text" id="username" placeholder="Username" class="w-full shadow-sm" required>
                    </div>
                    <div>
                        <input type="password" id="password" placeholder="Password" class="w-full shadow-sm" required>
                    </div>
                    <button type="submit" class="btn btn-primary w-full !py-3 !text-base">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>
                        Sign In Securely
                    </button>
                </form>
                <p id="login-error" class="text-red-400 text-sm mt-4 h-4 text-center"></p>
            </div>
        </div>

        <div id="student-view" class="view w-full max-w-5xl flex-col" style="display: none;">
            <header class="card mb-6 flex justify-between items-center animate-fadeInUp" style="animation-delay: 0.1s;">
                <div>
                    <h1 class="text-3xl font-bold">Student Dashboard</h1>
                    <p class="text-gray-300">Welcome, <span id="student-name" class="font-semibold text-white"></span>!</p>
                </div>
                <button id="logout-btn" class="btn btn-danger">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" /></svg>
                    Logout
                </button>
            </header>

            <div id="student-events-section" class="card mb-6 w-full animate-fadeInUp" style="animation-delay: 0.2s;">
                <h2 class="text-2xl font-bold mb-4">Campus Events</h2>
                <div class="space-y-6">
                    <div>
                        <h3 class="text-lg font-semibold text-green-400 mb-2">ðŸŸ¢ Ongoing</h3>
                        <div id="ongoing-events" class="space-y-2"></div>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold text-blue-400 mb-2">ðŸ”¼ Upcoming</h3>
                        <div id="upcoming-events" class="space-y-2"></div>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold text-gray-400 mb-2">ðŸ”½ Past</h3>
                        <div id="past-events" class="space-y-2"></div>
                    </div>
                </div>
            </div>

            <div class="grid md:grid-cols-2 gap-6 w-full">
                <div class="card animate-fadeInUp" style="animation-delay: 0.3s;">
                    <h2 class="text-2xl font-bold mb-4 flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>
                        Today's Schedule
                    </h2>
                    <div id="student-schedule" class="space-y-4"></div>
                </div>
                <div class="flex flex-col gap-6">
                    <div class="card animate-fadeInUp" style="animation-delay: 0.4s;">
                        <h2 class="text-2xl font-bold mb-4 flex items-center gap-2">
                           <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4" /></svg>
                            My Goals
                        </h2>
                        <div id="student-goals" class="space-y-3"></div>
                    </div>
                    <div class="card animate-fadeInUp" style="animation-delay: 0.5s;">
                        <h2 class="text-2xl font-bold mb-4">Free Period Smart Tasks</h2>
                        <p class="text-sm text-gray-300 mb-4">AI-powered suggestions based on your goals and interests.</p>
                        <button id="generate-tasks-btn" class="btn btn-secondary w-full">
                            âœ¨ Generate Smart Tasks
                        </button>
                        <div id="tasks-loader" class="hidden text-center mt-4">
                            <div class="spinner h-6 w-6 text-fuchsia-400 mx-auto"></div>
                            <p class="text-sm text-gray-400 mt-2">Generating ideas...</p>
                        </div>
                        <div id="tasks-output" class="mt-4 space-y-3"></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="teacher-view" class="view w-full max-w-6xl flex-col" style="display: none;">
            <header class="card mb-6 flex justify-between items-center animate-fadeInUp" style="animation-delay: 0.1s;">
                <div>
                    <h1 class="text-3xl font-bold">Teacher Dashboard</h1>
                    <p class="text-gray-300">Welcome, <span id="teacher-name" class="font-semibold text-white"></span>!</p>
                </div>
                <button id="logout-btn-teacher" class="btn btn-danger">
                    Logout
                </button>
            </header>
            <div class="card w-full animate-fadeInUp" style="animation-delay: 0.2s;">
                   <div class="flex flex-wrap justify-between items-center mb-6 gap-4">
                    <h2 class="text-2xl font-bold">Real-time Attendance</h2>
                    <div class="flex items-center space-x-2 bg-white/10 p-2 rounded-lg">
                        <label for="class-select" class="font-semibold text-sm">Current Class:</label>
                        <select id="class-select" class="p-2 border-0 shadow-sm !rounded-md"></select>
                    </div>
                </div>
                <div id="attendance-grid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4"></div>
                <div class="text-center mt-8 border-t border-white/10 pt-6">
                    <button id="generate-qr-btn" class="btn btn-primary">
                        Generate New Attendance QR Code
                    </button>
                </div>
            </div>
        </div>
        
        <div id="admin-view" class="view w-full max-w-5xl flex-col" style="display: none;">
             <header class="card mb-6 flex justify-between items-center animate-fadeInUp" style="animation-delay: 0.1s;">
                <div>
                    <h1 class="text-3xl font-bold">Administrator Dashboard</h1>
                    <p class="text-gray-300">Welcome, <span id="admin-name" class="font-semibold text-white"></span>!</p>
                </div>
                <button id="logout-btn-admin" class="btn btn-danger">
                    Logout
                </button>
            </header>
            <div class="grid md:grid-cols-3 gap-6 w-full">
                <div class="card text-center animate-fadeInUp" style="animation-delay: 0.2s;">
                    <h3 class="text-lg font-semibold text-gray-300">Total Students</h3>
                    <p id="total-students" class="text-5xl font-extrabold text-white mt-2">0</p>
                </div>
                <div class="card text-center animate-fadeInUp" style="animation-delay: 0.3s;">
                    <h3 class="text-lg font-semibold text-gray-300">Total Teachers</h3>
                    <p id="total-teachers" class="text-5xl font-extrabold text-white mt-2">0</p>
                </div>
                <div class="card text-center animate-fadeInUp" style="animation-delay: 0.4s;">
                    <h3 class="text-lg font-semibold text-gray-300">Overall Attendance</h3>
                    <p id="overall-attendance" class="text-5xl font-extrabold text-green-400 mt-2">0%</p>
                </div>
            </div>
        </div>

        <div id="event-manager-view" class="view w-full max-w-6xl flex-col" style="display: none;">
            <header class="card mb-6 flex justify-between items-center animate-fadeInUp" style="animation-delay: 0.1s;">
                <div>
                    <h1 class="text-3xl font-bold">Event Manager Dashboard</h1>
                    <p class="text-gray-300">Welcome, <span id="event-manager-name" class="font-semibold text-white"></span>!</p>
                </div>
                <button id="logout-btn-event-manager" class="btn btn-danger">
                    Logout
                </button>
            </header>
            <div class="grid md:grid-cols-2 gap-6 w-full">
                <div class="card animate-fadeInUp" style="animation-delay: 0.2s;">
                    <h2 class="text-2xl font-bold mb-4">Create New Event</h2>
                    <form id="create-event-form" class="space-y-4">
                        <input type="text" id="event-title" placeholder="Event Title" required>
                        <div class="grid grid-cols-2 gap-4">
                            <input type="date" id="event-date" required>
                            <input type="time" id="event-start-time" required>
                        </div>
                        <input type="time" id="event-end-time" placeholder="End Time" required>
                        <input type="text" id="event-location" placeholder="Location (e.g., Auditorium)" required>
                        <input type="text" id="event-organizer" placeholder="Organizer (e.g., CS Department)" required>
                        <textarea id="event-description" placeholder="Full event description..." rows="4" required></textarea>
                        <button type="submit" class="btn btn-success w-full">Create Event</button>
                    </form>
                </div>
                <div class="card animate-fadeInUp" style="animation-delay: 0.3s;">
                    <h2 class="text-2xl font-bold mb-4">Current Events</h2>
                    <div id="event-list-manager" class="space-y-3 max-h-96 overflow-y-auto">
                        </div>
                </div>
            </div>
        </div>
    </div>

    <div id="qr-modal" class="fixed inset-0 modal-backdrop flex items-center justify-center hidden z-50">
        <div class="modal-content p-8 rounded-2xl shadow-2xl text-center relative max-w-sm w-full animate-fadeInUp">
            <button id="close-qr-modal" aria-label="Close" class="absolute top-4 right-4 text-gray-400 hover:text-white text-3xl">&times;</button>
            <h2 class="text-2xl font-bold mb-2 text-white">Scan to Mark Attendance</h2>
            <p id="qr-modal-class-info" class="text-gray-300 mb-4"></p>
            <div id="qrcode-container" class="flex justify-center p-4 bg-white rounded-lg">
                <canvas id="qrcode"></canvas>
            </div>
            <p class="mt-4 text-sm text-gray-400">This QR code is now active.</p>
        </div>
    </div>

    <div id="goal-modal" class="fixed inset-0 modal-backdrop flex items-center justify-center hidden z-50">
        <div class="modal-content p-8 rounded-2xl shadow-2xl relative max-w-lg w-full animate-fadeInUp">
            <button id="close-goal-modal" aria-label="Close" class="absolute top-4 right-4 text-gray-400 hover:text-white text-3xl">&times;</button>
            <h2 class="text-2xl font-bold mb-2 text-white">âœ¨ AI-Powered Goal Breakdown</h2>
            <p id="goal-modal-title" class="text-gray-300 mb-4"></p>
            <div id="goal-modal-loader" class="hidden text-center my-4">
                <div class="spinner h-8 w-8 text-fuchsia-400 mx-auto"></div>
                <p class="text-sm text-gray-400 mt-2">Breaking it down for you...</p>
            </div>
            <div id="goal-modal-content" class="text-gray-300 space-y-2"></div>
        </div>
    </div>
    
    <div id="event-details-modal" class="fixed inset-0 modal-backdrop flex items-center justify-center hidden z-50 p-4">
        <div class="modal-content p-8 rounded-2xl shadow-2xl relative max-w-2xl w-full animate-fadeInUp">
            <button id="close-event-modal" aria-label="Close" class="absolute top-4 right-4 text-gray-400 hover:text-white text-3xl">&times;</button>
            <h2 id="event-modal-title" class="text-3xl font-bold mb-2 text-white"></h2>
            <div class="flex flex-wrap gap-x-6 gap-y-2 text-gray-300 mb-4 border-b border-white/10 pb-4">
                <p><strong>Date:</strong> <span id="event-modal-date"></span></p>
                <p><strong>Time:</strong> <span id="event-modal-time"></span></p>
                <p><strong>Location:</strong> <span id="event-modal-location"></span></p>
                <p><strong>Organizer:</strong> <span id="event-modal-organizer"></span></p>
            </div>
            <div id="event-modal-description" class="text-gray-200"></div>
        </div>
    </div>

    <div id="scanner-modal" class="fixed inset-0 bg-gray-900 flex items-center justify-center hidden z-50 p-4">
        <div class="bg-white p-6 rounded-2xl shadow-2xl text-center relative max-w-md w-full animate-fadeInUp">
            <button id="close-scanner-modal" aria-label="Close" class="absolute top-2 right-3 text-gray-600 hover:text-gray-900 text-3xl">&times;</button>
            <h2 class="text-xl font-bold mb-4 text-gray-800">Scan Attendance QR Code</h2>
            <div id="qr-reader" class="w-full border-4 border-gray-300 rounded-lg overflow-hidden aspect-square max-w-xs mx-auto"></div>
            <p class="mt-4 text-sm text-gray-500">Point your camera at the QR code shown by the teacher.</p>
        </div>
    </div>
    
    <div id="toast-notification" class="fixed bottom-5 left-1/2 -translate-x-1/2 px-6 py-3 rounded-lg text-white font-semibold shadow-lg transition-all duration-300 ease-in-out opacity-0 translate-y-4 hidden items-center gap-3 z-[100]">
        <span id="toast-icon"></span>
        <span id="toast-message"></span>
    </div>
    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-auth-compat.js"></script>

    <script>
      const firebaseConfig = {
    apiKey: "AIzaSyBAy1NPtuH1TkXwH_GBj3zmulUXKun9SVU",
    authDomain: "smartcampusapp-41f96.firebaseapp.com",
    projectId: "smartcampusapp-41f96",
    storageBucket: "smartcampusapp-41f96.firebasestorage.app",
    messagingSenderId: "975153054838",
    appId: "1:975153054838:web:4c0f3e3f88772b004b0b57",
    measurementId: "G-0KENCS7RNY"
};

      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
      
      // Make firestore easily accessible
      const db = firebase.firestore();
    </script>

    <script type="module" src="app.js"></script>
</body>
</html>